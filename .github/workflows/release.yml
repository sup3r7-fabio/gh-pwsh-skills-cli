name: Legacy Release (Disabled)

# DISABLED: This workflow is disabled to prevent conflicts with the new semver-based release system
# Use one of the following instead:
# - .github/workflows/beta-release.yml (manual releases)
# - .github/workflows/release-on-tag.yml (tag-based releases)
# - .github/workflows/strict-semver-release.yml (strict semver only)
# - .github/workflows/flexible-semver-release.yml (extended semver patterns)

on:
  workflow_dispatch:
    inputs:
      version:
        description: 'Release version (e.g., v1.0.0) - LEGACY WORKFLOW'
        required: true
        type: string
      force_legacy:
        description: 'Force use of legacy workflow (not recommended)'
        required: false
        type: boolean
        default: false

env:
  GO_VERSION: '1.25.3'

jobs:
  legacy-warning:
    name: Legacy Workflow Warning
    runs-on: ubuntu-latest
    if: github.event.inputs.force_legacy != 'true'
    steps:
    - name: Legacy workflow warning
      run: |
        echo "âŒ LEGACY WORKFLOW DISABLED"
        echo "================================="
        echo "This workflow has been disabled to prevent conflicts."
        echo ""
        echo "ðŸ”„ Use these workflows instead:"
        echo "  Manual releases: .github/workflows/beta-release.yml"
        echo "  Tag releases: .github/workflows/release-on-tag.yml" 
        echo "  Strict semver: .github/workflows/strict-semver-release.yml"
        echo "  Flexible semver: .github/workflows/flexible-semver-release.yml"
        echo ""
        echo "ðŸ·ï¸  Create a semver tag to trigger automatic release:"
        echo "  git tag v1.0.0 && git push origin v1.0.0"
        exit 1

  test:
    name: Test (Legacy)
    runs-on: ubuntu-latest
    if: github.event.inputs.force_legacy == 'true'
    steps:
    - name: Checkout
      uses: actions/checkout@v4
      
    - name: Set up Go
      uses: actions/setup-go@v4
      with:
        go-version: ${{ env.GO_VERSION }}
        
    - name: Cache Go modules
      uses: actions/cache@v3
      with:
        path: ~/go/pkg/mod
        key: ${{ runner.os }}-go-${{ hashFiles('**/go.sum') }}
        restore-keys: |
          ${{ runner.os }}-go-
          
    - name: Download dependencies
      run: go mod download
      
    - name: Run tests
      run: go test -v ./...
      
    - name: Build
      run: go build -v ./...

  release:
    name: Release (Legacy - Deprecated)
    needs: test
    runs-on: ubuntu-latest
    if: github.event.inputs.force_legacy == 'true'
    permissions:
      contents: write
      packages: write
      
    steps:
    - name: Checkout
      uses: actions/checkout@v4
      with:
        fetch-depth: 0
        
    - name: Set up Go
      uses: actions/setup-go@v4
      with:
        go-version: ${{ env.GO_VERSION }}
        
    - name: Cache Go modules
      uses: actions/cache@v3
      with:
        path: ~/go/pkg/mod
        key: ${{ runner.os }}-go-${{ hashFiles('**/go.sum') }}
        restore-keys: |
          ${{ runner.os }}-go-

    - name: Set release version
      id: version
      run: |
        if [ "${GITHUB_EVENT_NAME}" = "workflow_dispatch" ]; then
          echo "version=${{ github.event.inputs.version }}" >> $GITHUB_OUTPUT
        else
          echo "version=${GITHUB_REF#refs/tags/}" >> $GITHUB_OUTPUT
        fi

    - name: Run GoReleaser
      uses: goreleaser/goreleaser-action@v5
      with:
        distribution: goreleaser
        version: latest
        args: release --clean
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        
    - name: Update GitHub CLI extension manifest
      run: |
        echo "Release ${{ steps.version.outputs.version }} completed successfully!"
        echo "Extension can be installed with: gh extension install sup3r7-fabio/gh-pwsh-skills"
